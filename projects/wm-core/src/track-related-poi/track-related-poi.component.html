<ng-container *ngIf="visiblePois$|async as pois">
  <ion-label>{{'Punti di interesse' | wmtrans}}</ion-label>
  <div *ngFor="let poi of pois" class="webmapp-track-poi-list">
    <div
      class="webmapp-track-poi-item"
      (click)="selectPoi(poi)"
      [ngClass]="{'selected': (currentRelatedEcPid$|async) != null && poi.properties?.id == (currentRelatedEcPid$|async)}"
    >
      <ng-container *ngIf="poi.properties as properties">
        <ng-container *ngIf="properties.feature_image != null as featureImage;else svgTemplate">
          <img class="webmapp-track-poi-img" [src]="properties.feature_image?.sizes?.['108x148']" />
        </ng-container>
        <ng-template #svgTemplate>
          <ng-container *ngIf="icons$|async as icons; else noImage">
            <div
              *ngIf="icons[properties?.taxonomy?.poi_type?.icon_name] != null; else legacyIcon"
              appBuildSvg
              class="wm-filter-icon"
              [svg]="icons[properties?.taxonomy?.poi_type?.icon_name]"
            ></div>
            <!-- TODO: [icon_name] da rimuovere una volta rigenerate tutte le tracce -->
            <ng-template #legacyIcon>
              <div
                appBuildSvg
                *ngIf="properties?.taxonomy?.poi_type?.icon != null; else noImage"
                [svg]="properties?.taxonomy?.poi_type?.icon"
              ></div>
            </ng-template>
          </ng-container>
        </ng-template>
        <ng-template #noImage>
          <img class="webmapp-track-poi-img" [src]="defaultPhotoPath" />
        </ng-template>

        <div class="webmapp-track-poi-text">
          <div class="webmapp-track-poi-title">
            {{ properties.name | wmtrans }}
            <!-- | lowercase -->
          </div>
          <div
            class="webmapp-track-poi-distance-from-current-location"
            *ngIf="properties?.distanceFromCurrentLocation != null"
          >
            {{ 'Distanza da te' | wmtrans }}
            <span
              [innerHTML]="properties.distanceFromCurrentLocation | distance:'auto':0:'html'"
            ></span>
          </div>
          <div class="webmapp-track-poi-btns">
            <div class="webmapp-poi-popup-btn" *ngIf="properties.address">
              <i class="wm-icn icon-fill-pin"></i>
            </div>
            <div class="webmapp-poi-popup-btn" *ngIf="properties.contact_phone" target="_blank">
              <i class="wm-icn icon-fill-phone"></i>
            </div>
            <div class="webmapp-poi-popup-btn" *ngIf="properties.contact_email" target="_blank">
              <i class="wm-icn icon-fill-mail"></i>
            </div>
            <div class="webmapp-poi-popup-btn" *ngIf="properties.related_url != null">
              <i class="wm-icn icon-fill-globe"></i>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
  <ion-button
    *ngIf="showExpandButton$|async"
    color="light"
    expand="block"
    mode="ios"
    (click)="toggleExpand()"
  >
    {{ (isExpanded$|async) ? ('Mostra meno' | wmtrans) : ('Mostra tutti' | wmtrans) }}
  </ion-button>
</ng-container>
